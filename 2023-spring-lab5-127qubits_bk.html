

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>127 量子ビットを使う（2023年春 Lab5） &#8212; IBM Quantum Challengeで学ぶ量子コンピューティング</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2023-spring-lab5-127qubits_bk';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="エラー訂正（2023年春 Lab4）" href="2023-spring-lab4-error-correction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">本ページはQiskit 0.44に対応しています。Qiskit 1.0 ver.は<a href="https://quantum-tokyo.github.io/ibm-quantum-challenge-textbook/">こちら</a>(移行後本ページはCloseします)</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/quantum-tokyo-icon.jpg" class="logo__image only-light" alt="IBM Quantum Challengeで学ぶ量子コンピューティング - Home"/>
    <script>document.write(`<img src="_static/quantum-tokyo-icon.jpg" class="logo__image only-dark" alt="IBM Quantum Challengeで学ぶ量子コンピューティング - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    IBM Quantum Challengeで学ぶ量子コンピューティング
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">第１章 はじめてのQiskit</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2023-spring-lab1-sample.html">サンプル問題（2023年春）</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第２章 量子コンピューターの計算ルール</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2019-w1-adder.html">量子回路における加算器（2019年 Week1）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2020-w1-a-adder.html">量子回路における加算器（2020年 Week1a）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2021-spring-lab1-toffoli.html">トフォリゲート(2021年春 Lab1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="2023-spring-lab2-teleportation.html">量子テレポーテーション（2023年 Lab2）</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第３章 量子アルゴリズム</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2019-w2-grover.html">Groverのアルゴリズム（2019年 Week2）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2020-w1-b-grover_bk.html">Groverのアルゴリズム（2020年 Week1b）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2020-w2-a-lights-out-puzzle_bk.html">ライツアウトパズル（2020年 Week2a）</a></li>

<li class="toctree-l1"><a class="reference internal" href="2020-w2-b-lights-out-puzzle_bk.html">4-ライツアウトパズル（2020年 Week2b）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2020-w3-false-asteroids_bk.html">作り損ねた惑星問題（2020年 Week3）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2023-spring-lab3-iqpe.html">反復位相推定（2023年春 Lab3）</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第４章 量子コンピューターの応用</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2021-autumn-lab1-portfolio_bk.html">ポートフォリオ最適化（2021年秋 Lab1）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-spring-lab1-tb-model.html">強結合モデル（2022年春 Lab1）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-spring-lab2-tb-model.html">5点の強結合格子（2022年春 Lab2）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-spring-lab3-many-body-systems.html">多体系量子力学（2022年春 Lab3）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2019-w3-maxcut_bk.html">自治体のコンビニ出店プラン（2019年 Week4）</a></li>
<li class="toctree-l1"><a class="reference internal" href="2022-autumn-lab2-quantum-kernel_bk.html">Qiskit Runtimeを使った量子カーネル学習（2022秋 Lab2）</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">第５章 量子コンピューターのエラー訂正・緩和</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="2023-spring-lab4-error-correction.html">エラー訂正（2023年春 Lab4）</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">127 量子ビットを使う（2023年春 Lab5）</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/quantum-tokyo/iqc-textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/quantum-tokyo/iqc-textbook/issues/new?title=Issue%20on%20page%20%2F2023-spring-lab5-127qubits_bk.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2023-spring-lab5-127qubits_bk.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>127 量子ビットを使う（2023年春 Lab5）</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-ghz">Step 1: 大きなGHZ状態を作る</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise 1 - 解答例</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2">Step 2: サイズを半分にする</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise 2 - 解答例</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3">Step 3: 準備し、実デバイスで実行する</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-ghz">Step 4: GHZ状態のテスト</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3">Exercise 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise 3 - 解答例</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">ボーナス: エラー訂正への道</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">Step 1: 実際の状態はどの程度よかったのか？</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Step 2: なぜ単一のスタビライザーだけでは不十分なのか</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Step 3: エラーを増やさないためにはどうするか？</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4">Step 4: 何ができるでしょうか？</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab5">
<h1>127 量子ビットを使う（2023年春 Lab5）<a class="headerlink" href="#lab5" title="Permalink to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>このNotebookは、ibm_brisbane用にコードを改変しています。</p>
</div>
<p>これまでのChallengeが解けたとのこと、おめでとうございます！Dyanmic circuitをうまく使えることがわかりましたね。
ここまで来たご褒美として、127量子ビットデバイスの1つを使うことができます。</p>
<p>注意事項として、Challengeの完了でバッジを獲得するには、5つのLabのうち4つを終了している必要があります。このように決定した理由は、このLabが (a)技術的に困難であり、 (b)当社の最先端のハードウェアを使用することが分かっているためで、意図的にこのように決定しました。100量子ビットを超えるデバイスを一般に公開すると、ジョブの実行に大きな遅れが生じる可能性があるというのが実情です。Challengeの終了までにジョブを成功させることができない可能性もあります（そうでないことを祈りますが！）。そのようなことがないように、私たちは舞台裏でできる限りのことをしていますが、しかし、今年のChallengeは過去最高の参加者数を記録しています。親切に、何度も回路を提出し、キューを詰まらせないようにしてください。</p>
<p>まず、深呼吸してみましょう。では、始めましょう！</p>
<p>実際の物理的なデバイスを扱うには、それなりの困難が伴うことは、すでにお分かりいただけたと思います。
多数の量子ビットを使用する場合は、経路が長くなり、多くのエラーが発生しないようにする必要があるため、なおさらです。ここでは、ibm_sherbrookをデバイスとして使用します。</p>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>2023年末現在、誰でも無償利用可能の127量子ビットデバイスである、 <a class="reference external" href="https://quantum.ibm.com/services/resources?system=ibm_brisbane">ibm_brisbane</a> を使います。デバイストポロジーは、ibm_sherbrookと同じです。</p>
</div>
<p>この課題では、127量子ビットの完全なエンタングル状態、いわゆるGHZ状態を賢い方法で準備してもらいます。</p>
<p>その後、エラー訂正の知識を127量子ビットのGHZ状態に適用し、54量子ビットのGHZ状態を作成するようガイドします。そのために、54量子ビットGHZ状態には偶数量子ビットを使用し、奇数量子ビットはスタビライザーとして使用することにします。</p>
<p><em>注：奇数量子ビットと偶数量子ビットの使い方が違っても、同じレジスターを使うことにします。これは、特にDepthを手動で最適化する場合に、最初の127量子ビットのGHZ状態を簡単に作成できるようにするためです。</em></p>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>偶数量子ビット（even numbered qubits）、奇数量子ビット（odd numbered qubits）という言葉を使っていますが、偶数番号の量子ビット、奇数番号の量子ビットの意味ではなく、下のセルで設定された量子ビット番号のことを意味しています。</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 必要な部品をインポートします</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">transpile</span><span class="p">,</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">ClassicalRegister</span>
<span class="kn">from</span> <span class="nn">qiskit.result</span> <span class="kn">import</span> <span class="n">marginal_counts</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="n">pi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>

<span class="c1"># レジスターを準備します</span>
<span class="n">quantum_register</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>
<span class="n">classical_register</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>

<span class="c1"># 簡単のため、物理量子ビットを論理量子ビットに直接マッピングします</span>
<span class="n">initial_layout</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> 
                   <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span>
                   <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span>
                   <span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span>
                   <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span>
                  <span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span><span class="mi">113</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">119</span><span class="p">,</span>
                  <span class="mi">120</span><span class="p">,</span><span class="mi">121</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">126</span><span class="p">]</span>
<span class="c1"># 「偶数」量子ビットは54量子ビットのGHZ状態に使われます。名前はqhz_qubitです：</span>
<span class="n">ghz_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span>
              <span class="mi">41</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span>
              <span class="mi">81</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">126</span><span class="p">,]</span>
<span class="c1"># 「奇数」量子ビットはスタビライザーとして使われます。名前はstabilizer_qubitsです：</span>
<span class="n">stabilizer_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span>
                     <span class="mi">40</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">57</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">67</span><span class="p">,</span><span class="mi">69</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">73</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">76</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span>
                     <span class="mi">80</span><span class="p">,</span><span class="mi">82</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">91</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">117</span><span class="p">,</span><span class="mi">119</span><span class="p">,</span><span class="mi">121</span><span class="p">,</span><span class="mi">123</span><span class="p">,</span><span class="mi">125</span><span class="p">,]</span>
</pre></div>
</div>
</div>
</div>
<section id="step-1-ghz">
<h2>Step 1: 大きなGHZ状態を作る<a class="headerlink" href="#step-1-ghz" title="Permalink to this heading">#</a></h2>
<p>多くの量子アルゴリズムでは、複数の量子ビットを互いにエンタングルする必要があります。
アルゴリズムでよく使われる状態の1つに、一般化されたGHZ状態があり、 <span class="math notranslate nohighlight">\((\alpha |00...0\rangle + \beta |11...1\rangle)\)</span> このとき <span class="math notranslate nohighlight">\(\alpha = \beta\)</span> という状態です。</p>
<p>GHZ状態は完全にエンタングルされており、任意の数の量子ビットに一般化することができます。ここでは、これを用いて127量子ビットのGHZ状態を作ることにします！
<strong>何個の量子ビットによるGHZ状態であっても、GHZ状態は測定されると、すべての量子ビットが0か1かのどちらかになっています。</strong></p>
<p>ここでのchallengeは、127個の量子ビットを理論的にエンタングルさせることではなく、 <em>実際のデバイス上で</em> エンタングルさせることです。つまり、デバイスのレイアウトを考慮する必要があります（例えば、互いに直接接続されていない量子ビットの間でCXゲートを使用しないなど）。また、ノイズを減らすために、回路の深さをできるだけ小さくするようにする必要があります。</p>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this heading">#</a></h3>
<div class="admonition-ghz admonition">
<p class="admonition-title">GHZ状態の生成</p>
<p>アダマールゲートとCNOTゲートだけを使って、127量子ビットのデバイス <code class="docutils literal notranslate"><span class="pre">ibm_sherbrook</span></code> にGHZ状態を生成してください。できるだけ回路のDepthが小さくなるようにしてみてください。</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>すべての量子ビットが互いに接続されている理想的なデバイスに対して、（最小のDepthで）どのように行うかを最初に考えることが助けになることがあります。</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_ghz127</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>

    <span class="c1">####### your code goes here #######</span>

    <span class="k">return</span> <span class="n">qc</span>


<span class="n">ghz_circuit</span> <span class="o">=</span> <span class="n">generate_ghz127</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ghz_circuit</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
</section>
<section id="id1">
<h3>Exercise 1 - 解答例<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 解答例</span>
<span class="k">def</span> <span class="nf">generate_ghz127</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>

    <span class="c1"># Add your code here</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

    <span class="c1"># Hadamard gate</span>
    <span class="c1"># qc.h(64)</span>
    <span class="c1"># qc.rz(pi/2, 63) not needed since qubit is in state 0</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
    <span class="c1"># qc.sx(64)</span>
    <span class="c1"># qc.rz(pi/2, 64)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">63</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">63</span><span class="p">,</span> <span class="mi">62</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">54</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">61</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">73</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">53</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">81</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">46</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">41</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">47</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mi">68</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">86</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">59</span><span class="p">,</span> <span class="mi">58</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">43</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">69</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">79</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">82</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">86</span><span class="p">,</span> <span class="mi">87</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">71</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">82</span><span class="p">,</span> <span class="mi">83</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">69</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">93</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">49</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">57</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">71</span><span class="p">,</span> <span class="mi">77</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mi">78</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">91</span><span class="p">,</span> <span class="mi">98</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">83</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">106</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">88</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">74</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">38</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">57</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="mi">76</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="mi">89</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">97</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">92</span><span class="p">,</span> <span class="mi">102</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span> <span class="mi">107</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">37</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">52</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">76</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span> <span class="mi">105</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">107</span><span class="p">,</span> <span class="mi">108</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">109</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="mi">104</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">112</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">94</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">111</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">109</span><span class="p">,</span> <span class="mi">114</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">112</span><span class="p">,</span> <span class="mi">126</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">118</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="mi">122</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">115</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">126</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">113</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="mi">116</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="mi">124</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">117</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">119</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>

    <span class="c1"># qc.barrier()</span>

    <span class="c1"># cxの数が124に等しく、Hゲートが1つで、それぞれが1度だけ、すでに重ね合わされているQubitからのみターゲットされるかどうかで、</span>
    <span class="c1"># 合っているかどうかチェックできます。</span>
    
    <span class="c1"># Add your code here</span>

    <span class="k">return</span> <span class="n">qc</span>


<span class="n">ghz_circuit</span> <span class="o">=</span> <span class="n">generate_ghz127</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ghz_circuit</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>上記のコードは、公式の正解例で、depthは17です。
このdepthに到達する過程を考えてみましょう。まずは、問題文のヒントにあるように理想的なデバイスで考えます。</p>
<ol class="arabic simple">
<li><p>特に工夫をせずに、GHZ状態を作るには、1個目のQubitにHadamardゲートをかけ、そのほかのQubitとCNOTとでつなぐと作ることができます。この場合、すべての量子ビットが互いに接続されている理想的なデバイスであれば、depthは最初のHゲートを含めて127になります。しかし、実際のデバイスでは、すべての量子ビットが接続されているわけではないため、depthは、これよりかなり大きくなります。
下の図は8量子ビットの時の例です。</p></li>
</ol>
<p><img alt="" src="_images/2023-spring-ghz-1.jpg" /></p>
<ol class="arabic simple" start="2">
<li><p>すべての量子ビットが互いに接続されている理想的なデバイスで、最もdepthを減らすには、<a class="reference external" href="https://ja.wikipedia.org/wiki/%E6%9C%A8%E6%A7%8B%E9%80%A0_(%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0)">木構造</a>にすることです。 <span class="math notranslate nohighlight">\(\log_2 n = \log_2 125 = 6.97\)</span> より、depthは最初のHゲートを含めて、8になります。実際のデバイスでは、これよりだいぶ大きくなります。
下の図は8量子ビットの時の例です。
<img alt="" src="_images/2023-spring-ghz-2.jpg" /></p></li>
<li><p>さらにデバイスの接続情報をグラフネットワークの問題として考慮し、Hゲートを置くための中心をみつけ、木構造でパスの最適解を探します。グラフの最も中心を見つけるアルゴリズムには、ネットワークの中心を分析する媒介中心性アルゴリズム(<a class="reference external" href="https://qiita.com/igenki/items/a673140ecbfda4ee7dba">参照</a>)などを使って探すことができます。また、ツリーの深さを最小にするためのパスを見つけるには、<a class="reference external" href="https://ja.wikipedia.org/wiki/%E5%B9%85%E5%84%AA%E5%85%88%E6%8E%A2%E7%B4%A2">幅優先探索アルゴリズム</a>を使うことができます。</p></li>
</ol>
<p>参考に、https://quantum-computing.ibm.com/services/resources?view=table&amp;system=ibm_brisbane　で、ibm_brisbane のデバイスの接続トポロジーを確認します。
偶数量子ビットを緑色、奇数量子ビットを赤色にすると以下のようになります。（このExerciseは、偶数量子ビット、奇数量子ビット関係なく、127量子ビットのGHZ状態を作るのが問題です。）
<img alt="" src="_images/2023-spring-brisbabe.jpg" /></p>
</div>
</section>
</section>
<section id="step-2">
<h2>Step 2: サイズを半分にする<a class="headerlink" href="#step-2" title="Permalink to this heading">#</a></h2>
<p>ここで、作成したGHZ状態を利用して、偶数量子ビットを使った縮小GHZ状態を形成したいと思います。そのためには、GHZ状態を崩壊させることなく測定できるように、奇数量子ビットのエンタングルメントを解消させる必要があります。</p>
<p>量子ビットをアンエンタングルしたいので、Lab４でやったのと同じように、 <strong>スタビライザー</strong> を生成する方法で行います。スタビライザーは、接続されている両方の量子ビットが同じ値であれば0になり、異なる値であれば1になるはずです。</p>
<p>このようなことをすることに何の意味があるのでしょうか？鋭い観察者はすでに気づいているかもしれませんが、このスタビライザーを使って、縮小されたGHZ状態にエラー訂正を適用することができるのです。</p>
<section id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this heading">#</a></h3>
<div class="admonition-ghz admonition">
<p class="admonition-title">GHZ状態のアンエンタングル</p>
<p>スタビライザーを作るために、作られたGHZ状態の奇数量子ビットをアンエンタングルしてください。ここでも、回路のDepthをできるだけ小さくすることに挑戦できます。</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>上記のGHZ状態の作り方を考慮に入れてください。アンエンタングリングの方法は、その作成方法に特化したものです。</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">deentangle_qubits</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>

    <span class="c1">####### your code goes here #######</span>

    <span class="k">return</span> <span class="n">qc</span>


<span class="n">unentangle_circuit</span> <span class="o">=</span> <span class="n">deentangle_qubits</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unentangle_circuit</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>

<span class="n">complete_circuit</span> <span class="o">=</span> <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">unentangle_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id2">
<h3>Exercise 2 - 解答例<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 解答例</span>
<span class="k">def</span> <span class="nf">deentangle_qubits</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>

    <span class="c1"># Add your code here</span>
    <span class="c1">#</span>
    <span class="c1">#</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">63</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">54</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">73</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">53</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">46</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">67</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">86</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">83</span><span class="p">,</span> <span class="mi">82</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">83</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span>  <span class="c1"># other side</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">69</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="mi">71</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="mi">78</span><span class="p">)</span>  <span class="c1"># other side</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span> <span class="mi">93</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mi">88</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mi">74</span><span class="p">)</span>  <span class="c1"># other side</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">52</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">76</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">97</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">107</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>  <span class="c1"># other side</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">105</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">103</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">109</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">126</span><span class="p">,</span> <span class="mi">112</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">118</span><span class="p">,</span> <span class="mi">110</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="mi">111</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># other side</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">115</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">124</span><span class="p">,</span> <span class="mi">125</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">118</span><span class="p">,</span> <span class="mi">117</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">119</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">124</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>

    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">113</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">qc</span>


<span class="n">unentangle_circuit</span> <span class="o">=</span> <span class="n">deentangle_qubits</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unentangle_circuit</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>

<span class="n">complete_circuit</span> <span class="o">=</span> <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">unentangle_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>「アンエンタングル」とはエンタングルメント状態を解除することを意味しています。あるビットのみアンエンタングルするには、そのビットをエンタングルした時にかけたCNOTを再度かければ良いことになります。</p>
<p>アンエンタングルする回路のdepthは2となりました。</p>
</div>
<p>よくできました。さて、すべての奇数量子ビットは偶数量子ビットとエンタングルしていないので、GHZ状態を壊すことなく測定することができます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># スタビライザーを測定することで、後処理で何が悪かったのかを確認することもできます</span>

<span class="k">def</span> <span class="nf">measure_stabilizers</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">stabilizer_qubits</span><span class="p">,</span> <span class="n">stabilizer_qubits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qc</span>


<span class="n">stabilizer_circuit</span> <span class="o">=</span> <span class="n">measure_stabilizers</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>これらの測定結果は、54量子ビットのGHZ状態を改善するために使用することができますが、このアイデアは後で検討します。</p>
<p>奇数量子ビットを測定した後、それらをリセットし、奇数量子ビットを潜在的な補助量子ビットとして使って、54量子ビットのGHZ状態をアルゴリズムに使用することができます。しかし、GHZ状態を使う前に、その実力を試してみましょう。</p>
<p>54量子ビットのGHZ状態を測定する必要があります！</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GHZ量子ビットを測定する</span>

<span class="k">def</span> <span class="nf">measure_ghz</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>
    <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">ghz_qubits</span><span class="p">,</span> <span class="n">ghz_qubits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qc</span>


<span class="n">measure_circuit</span> <span class="o">=</span> <span class="n">measure_ghz</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>では、すべてをまとめて、テストできるようにしましょう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 全てをまとめます</span>

<span class="n">simple_ghz</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">unentangle_circuit</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">stabilizer_circuit</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">measure_circuit</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>Ex1で作った「ghz_circuit」回路に、Ex2で作った「unentangle_circuit」回路を加え、
上記で作った、スタビライザー量子ビットのみを測定する回路「stabilizer_circuit」と
GHZ量子ビットのみを測定する回路「measure_circuit」を加えています。</p>
<p>よって、測定結果にはエンタングルしていない「stabilizer_circuit」が含まれるため、もともと理想的な測定結果は、<span class="math notranslate nohighlight">\(00 \cdots 00\)</span> と <span class="math notranslate nohighlight">\(11 \cdots 11\)</span> のみではないことに注意してください。</p>
<p>これで実機での実行を行います。</p>
</div>
</section>
</section>
<section id="step-3">
<h2>Step 3: 準備し、実デバイスで実行する<a class="headerlink" href="#step-3" title="Permalink to this heading">#</a></h2>
<p>GHZ状態を実際のデバイス上で実行する準備が整いましたので、<code class="docutils literal notranslate"><span class="pre">ibm_sherbrooke</span></code>の出番です。</p>
<p>127個の量子ビットを扱ったことのある人は、世界でもそう多くはないでしょう。あなたはすぐに、自分がその一人であると言える数少ない勇者の一人になるでしょう。量子コンピューターにとっては小さな一歩、あなたの履歴書にとっては大きな一歩です。</p>
<p>冗談です :-P</p>
<hr class="docutils" />
<p>まず、必要なものをすべて準備します。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># providerをimportし、systemにアクセスする</span>
<span class="kn">from</span> <span class="nn">qiskit_ibm_provider</span> <span class="kn">import</span> <span class="n">IBMProvider</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">transpile</span>

<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMProvider</span><span class="p">()</span>

<span class="c1"># hub = &quot;YOUR_HUB&quot; # Challenge期間中に使われたhub/group/project情報なので削除します</span>
<span class="c1"># group = &quot;YOUR_GROUP&quot;</span>
<span class="c1"># project = &quot;YOUR_PROJECT&quot;</span>

<span class="c1"># backend_name = &quot;ibm_sherbrooke&quot;  </span>
<span class="n">backend_name</span> <span class="o">=</span> <span class="s2">&quot;ibm_brisbane&quot;</span> <span class="c1"># 2023年末現在誰でも使えるデバイスに変更します</span>
<span class="c1"># backend = provider.get_backend(backend_name, instance=f&quot;{hub}/{group}/{project}&quot;)</span>
<span class="n">backend</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="n">backend_name</span><span class="p">)</span>

<span class="n">number_of_shots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>
</pre></div>
</div>
</div>
</div>
<p>まず、実際のデバイス用にトランスパイルすることから始めます。これは、あまり大きな変化はないはずです。なぜなら、回路を作るときに物理的なデバイスを念頭に置き、存在する接続だけを使用するようにした（はず）だからです。</p>
<p>もしそうでなかったなら、今すぐ戻って修正するか、Discordに飛び込んで、そのプロセスをどのように考えるかについて他の人と話し合う良い機会だと思います。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># まず、実際のデバイスへGHZ状態をトランスパイルします</span>
<span class="n">qc_transpiled</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">simple_ghz</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">initial_layout</span><span class="o">=</span><span class="n">initial_layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>この先の演習でも出てきますが、先にここで、参考のためにTranspile前後のdepthを以下で調べてみましょう。</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">simple_ghz</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qc_transpiled</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
56
</pre></div>
</div>
</div>
</div>
<p>これで127量子ビットデバイスでジョブを実行する準備が整いました。将来、簡単に見つけられるように、ここにタグを追加しておきましょう。</p>
<p>ジョブの実行には、他の人がどれだけジョブを実行しようとしているかにもよりますが、ある程度の時間がかかるでしょう。今日はもうコーヒーを飲まれましたか？それとも紅茶派ですか？Netflixで素晴らしい新番組があるそうですね。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># これでjobを実行できます</span>
<span class="c1"># 結果の良し悪しを分析しやすくするためにmemory=trueを追加し、後でタグを見つけやすくしています</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">qc_transpiled</span><span class="p">,</span>
    <span class="n">shots</span><span class="o">=</span><span class="n">number_of_shots</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">job_tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ghz_state&quot;</span><span class="p">,</span> <span class="s2">&quot;spring_challenge&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">job_id</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>chm3umk6f7i49rqqct4g
</pre></div>
</div>
</div>
</div>
<p>後で戻ってきて、ジョブを検索したい場合、<a class="reference external" href="https://quantum.ibm.com/jobs">IBM Quantum Computing Homepage</a>で、上で使用したタグで見つけることができます。</p>
<p>あなたのjobの名前（id）をコピーして、下のセルの <em>job_id</em> をあなたのものに置き換えてください。job IDは次のようなものです： <em>ch36cf1pleju56fajrqg</em></p>
<p>または、上記のセルのjob_idを直接使用することもできます。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_id</span> <span class="o">=</span> <span class="s2">&quot;cnhnbgeh9cj00083z30g&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># job id を &quot;ch36cf1pleju56fajrqg &quot;のように前回投入したjobのidに変更します</span>
<span class="c1"># 後からjobを確認したい場合にのみ以下をjob idを変更して実行します。</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">retrieve_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
<span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;JobStatus.DONE: &#39;job has successfully run&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># テストのためにjobのデータを得ます</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_memory</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>ここで、参考のために “data” の中身をいくつか見てみましょう。</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1023</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0000000000000000010010011001100001110001101000011000101110100010110100011001001100110100000110101011111001111000001010101010101
1010101011000000011010101010110000000000001101111000110110010011000100010111010110001101011111000101111011000000000001000110110
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>1024ショット数実行したうちの0ショット目と1023ショット目を表示させてみました。今回の測定回路は、スタビライザー量子ビットとGHZビットがほぼ交互に並んだ状態で測定されているので、ぱっと見では結果の良し悪しは分かりません。</p>
</div>
</section>
<section id="step-4-ghz">
<h2>Step 4: GHZ状態のテスト<a class="headerlink" href="#step-4-ghz" title="Permalink to this heading">#</a></h2>
<p>あなたはやり遂げました！127量子ビットマシンでGHZ状態の回路を走らせました。すごいですね!</p>
<p>さて、GHZ状態の結果が出たので、次はそれを検証してみましょう。エラー緩和やエラー訂正は一切していませんので、まだまだ結果に改善が期待できます。</p>
<p>結果がどの程度「良い」かを調べるには、さまざまな方法があります。生の結果を見ることもできますが、GHZ状態で使用される量子ビットは隣り合っていないので、少し煩わしいかもしれません。品質や、GHZ状態のエラーについて教えてくれる機能があれば便利です。</p>
<section id="exercise-3">
<h3>Exercise 3<a class="headerlink" href="#exercise-3" title="Permalink to this heading">#</a></h3>
<div class="admonition-ghz admonition">
<p class="admonition-title">GHZ状態のテスト</p>
<p>GHZ状態をテストするための関数を作成してください。</p>
<p>Challengeの作成者として、私たちは、あなたが結果をどのようにテストしたいのか、ここでいくつかの自由を与えることにしました。 <strong>あなたにとって</strong> 理にかなった方法を見つけてください。関数の <em>出力が低いほど、</em>　GHZ状態が <em>良好である</em> ことを示すことが重要です。</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>この関数は作成したデータをテストするために作成する必要があるため、GHZ状態の一部である量子ビットのみをテストする必要があります。</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># GHZ 状態の品質をテストする関数です。低いほど良い。</span>
<span class="k">def</span> <span class="nf">test_ghz</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ghz_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span>
              <span class="mi">41</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span>
              <span class="mi">81</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">126</span><span class="p">,]</span>

    <span class="c1">####### your code goes here #######</span>


<span class="n">test_ghz</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id3">
<h3>Exercise 3 - 解答例<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 解答例</span>
<span class="c1"># GHZ 状態の品質をテストする関数です。低いほど良い。</span>
<span class="k">def</span> <span class="nf">test_ghz</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ghz_qubits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span>
              <span class="mi">41</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">62</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">77</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span>
              <span class="mi">81</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">94</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">116</span><span class="p">,</span><span class="mi">118</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">126</span><span class="p">,]</span>
    <span class="c1">####### your code goes here #######</span>
    <span class="n">quality_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">average</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>   <span class="c1"># 1024です</span>
    <span class="n">worst</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">count_zeroes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count_ones</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bit_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">bit_count</span> <span class="o">=</span> <span class="n">bit_count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">bit_count</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ghz_qubits</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
                <span class="n">count_zeroes</span> <span class="o">=</span> <span class="n">count_zeroes</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count_ones</span> <span class="o">=</span> <span class="n">count_ones</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count_ones</span> <span class="o">&lt;</span> <span class="n">count_zeroes</span><span class="p">:</span>
            <span class="n">count_zeroes</span> <span class="o">=</span> <span class="n">count_ones</span>    <span class="c1"># 低いほど良くするために、0または1のうち少ない方をカウントします</span>

        <span class="n">quality_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_zeroes</span><span class="p">)</span>
        <span class="n">average</span> <span class="o">=</span> <span class="n">average</span> <span class="o">+</span> <span class="n">count_zeroes</span>

        <span class="k">if</span> <span class="n">count_zeroes</span> <span class="o">&gt;</span> <span class="n">worst</span><span class="p">:</span>
            <span class="n">worst</span> <span class="o">=</span> <span class="n">count_zeroes</span>
        <span class="k">if</span> <span class="n">count_zeroes</span> <span class="o">&lt;</span> <span class="n">best</span><span class="p">:</span>
            <span class="n">best</span> <span class="o">=</span> <span class="n">count_zeroes</span>

    <span class="n">average</span> <span class="o">=</span> <span class="n">average</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">worst</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">average</span>

<span class="n">test_ghz</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.0029296875
27
3
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.0029296875
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>GHZ状態の質を評価する方法はいろいろ考えられますが、解答例の手法は、
1024ショットのそれぞれのショットで、GHZビットのみにおいて、0と1の数をそれぞれ数えます。今回は、「関数の 出力が低いほど、　GHZ状態が 良好である ことを示す」ために、数が少ない方のカウント数を記録しておき、1024回分の平均値を出力しています。</p>
</div>
<p>これで、あなたが設計した関数に基づき、結果を評価する数字ができました。</p>
<p>先に進む前に、自分のやり方について考えてみましょう。</p>
<ul class="simple">
<li><p>本当に良い状態の時の数値はどうでしょうか？</p></li>
<li><p>本当に悪い状態の場合はどうでしょうか？</p></li>
<li><p>「悪い状態」とはどのような状態なのでしょうか？</p></li>
<li><p>どうすれば、何を言っているのか理解しやすい関数を設計できるのか？</p></li>
</ul>
<p>これらの疑問は、IBMの研究者が日々考えていることであり、私たちのデバイスやサービスを可能な限り強く、わかりやすくするために、非常に高いモチベーションを保ち続けています。もし、あなたがこのような仕事に興味をお持ちなら、ぜひ教えてください！</p>
<p>それでは、テスト機能をテストして、それがすべきことをするかどうか見てみましょう。エラーの少ない良い状態には低い結果を、エラーの多い状態には高い結果を与えるべきであることを忘れないでください。</p>
<p>さて、問題は、どうすれば改善できるかということです。</p>
<p>まず、回路のDepthをもっと小さくしてみることです。トランスパイルされた回路のDepthを見てみましょう：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc_transpiled</span><span class="o">.</span><span class="n">depth</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>56
</pre></div>
</div>
</div>
</div>
<p>トランスパイルプロセスで、Depthが2倍以上大きくなっていることがわかります。</p>
<div class="tip admonition">
<p class="admonition-title">解説</p>
<p>ghz_circuitのTranspile前のdepthは、Ex1で出しています。17でした。今回実行したsimple_ghzのdepthは、Transpile前は20でした。</p>
</div>
<p>このDepthがどこから来たのか、その様子をみてみましょう。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qc_transpiled</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8eb6f455b3c8a206a01f3b38d2f422180c3c19d92f0bef7c7a26bf049acf148e.png" src="_images/8eb6f455b3c8a206a01f3b38d2f422180c3c19d92f0bef7c7a26bf049acf148e.png" />
</div>
</div>
<p>アダマールゲートとCXゲートが、他のゲートにトランスパイルされていることがわかります。IBMの量子デバイスはどれもアダマールゲートを直接サポートしていないので、アダマールゲートについては、驚くべきことではありません。アダマールゲートは常に3つの回転ゲートで構成されます。一方、ご覧のECRゲートは新しいもので、一部のデバイスでしか使われていません。これもCXゲートに似たエンタングルゲートですが、仕組みが少し違います。CXゲートは、ECRゲート１つとローカル回転ゲートだけで作ることができます。</p>
<p>ECRゲートの詳細については、こちらをご覧ください.
: https://qiskit.org/documentation/stable/0.39/stubs/qiskit.circuit.library.ECRGate.html</p>
<p>Depthを減らすことは、エラー率を最小化するための最良の方法であることが多いです。ECRゲートが代わりに使われることがわかったところで、もっと良いDepthの回路を作ることはできないでしょうか？</p>
<p>その疑問や、GHZ状態をより良くするための他の方法を探ることに興味がある方は、どうぞ先をお読みください。このLabの次の部分は、ボーナス・パートです。この後にExerciseはありません。これは、エラー訂正をどのように使うことができるかを示すための短い展望であると同時に、エラー訂正がなぜ難しいかを示すためのものです。</p>
<p>続けるにしても、続けないにしても、自分に拍手を送ってあげてください： あなたは今、IBM Quantum Challenge: Spring 2023を完了したところです！Discordで他のみんなに自慢してください。Discordでお会いしましょう！</p>
</section>
</section>
<section id="id4">
<h2>ボーナス: エラー訂正への道<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>エラー訂正は、今でも活発で重要な研究テーマです。そのため、実機でのエラー訂正は、今回のGHZ状態の例のような単純なケースであっても、それほど簡単ではありません。このページでは、どのような方法が考えられるかについて、いくつかのガイダンスやヒントを提供しながら、独自のアイデアを生み出す機会を提供したいと思います。</p>
<section id="step-1">
<h3>Step 1: 実際の状態はどの程度よかったのか？<a class="headerlink" href="#step-1" title="Permalink to this heading">#</a></h3>
<p>エラーを修正する前に、まず状態がどの程度良かったかを知る必要がありますが、これさえも思ったほど簡単ではありません。</p>
<p>あなたのGHZ状態がどれだけ優れているかをテストする最も簡単な方法は、偶数量子ビットのうち、どれだけが多数派と異なる結果を得たかを調べることです。この方法は、上記で使用した方が多いのではないでしょうか？</p>
<p>しかし、これは必ずしもエラーの発生回数と相関があることを意味するものではありません。そして、GHZの良し悪しを知るには、エラーの発生数の方が重要であるとも言えます。</p>
<p><strong>例 A</strong> : この考えを説明するために、例えば、10個の一列に並んだ量子ビットで、GHZ状態を形成するとします：</p>
<p>0 - 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9</p>
<p>ここで、読み出しではなく、量子ビット4と量子ビット5の間でエンタングルゲートを適用したときにエラーが発生したとすると、出力は次のようになります：</p>
<p>0000011111</p>
<p>これは、「何個の量子ビットが同じ結果を出すか」という測定において、最悪の結果となります。</p>
<p>このため、より多くのエラーが発生するようにすれば、「何個の量子ビットが同じ結果を持つか」をより正確に測定できる可能性がありますが、ほとんどの場合、その状態はあまり役に立たなくなります。</p>
<p>もし上記のような状態が作られ、量子ビットの間で(機能する)スタビライザー測定が行われていたとしたら、量子ビット4と5の間の測定値が1になるだけです。そして、このエラーを修正するために、量子ビット5-9を反転させることが可能です。</p>
<p>あなたのケースでエラーがどのように見えるかを知るには、実際のデバイスで実行した結果である生データを見て、GHZ状態をどのように構築したかを考慮するのが良いアイデアかもしれません。</p>
<p><strong>例A</strong> の場合、次のようなエラー訂正が考えられます：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 例 A の簡単なアイデア: エラーが発生した場所を見つけて、それに応じて反転する</span>
<span class="k">def</span> <span class="nf">correct_ghz</span><span class="p">():</span>
    <span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">,</span> <span class="n">classical_register</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">qc</span><span class="o">.</span><span class="n">if_test</span><span class="p">((</span><span class="n">classical_register</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">qc</span><span class="o">.</span><span class="n">if_test</span><span class="p">((</span><span class="n">classical_register</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">qc</span><span class="o">.</span><span class="n">if_test</span><span class="p">((</span><span class="n">classical_register</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">qc</span><span class="o">.</span><span class="n">if_test</span><span class="p">((</span><span class="n">classical_register</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">qc</span><span class="o">.</span><span class="n">if_test</span><span class="p">((</span><span class="n">classical_register</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">qc</span><span class="o">.</span><span class="n">if_test</span><span class="p">((</span><span class="n">classical_register</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">quantum_register</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

    <span class="c1"># ...</span>

    <span class="c1"># qc.barrier()</span>
    <span class="k">return</span> <span class="n">qc</span>


<span class="n">correcting_circuit</span> <span class="o">=</span> <span class="n">correct_ghz</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>そして、もし今、私たちが上記のコードを私たちの54GHZのケースに適応させるなら、すべてを一緒に構築することができます：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Everything together corrected</span>

<span class="n">error_corrected_ghz</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ghz_circuit</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">unentangle_circuit</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">stabilizer_circuit</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">correcting_circuit</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">measure_circuit</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3>Step 2: なぜ単一のスタビライザーだけでは不十分なのか<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<p>エラー訂正のExerciseでは、スタビライザー量子ビットの測定から、1ビット、またはビット列全体を使用して、その演算を条件付けることができることを確認しました。</p>
<p>スタビライザー測定は54ビットなので、ビット列全体を条件付けに使うのは現実的ではありません。なぜなら、2^54個の異なるビット列を考慮する必要があるからです。</p>
<p>一方、1ビットだけを考慮する場合は、不可能であるか、または過度に複雑になる可能性があります。</p>
<p><strong>例</strong>: 再び10個の量子ビットを一列に接続し、それらでGHZ状態を形成します：</p>
<p>0 - 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9</p>
<p>ここで、測定結果として0000010000が得られたと仮定します。</p>
<p>この場合、スタビライザー測定では、1の右側と1の左側がともに値1になります。</p>
<p>つまり、この場合、1つのスタビライザーを見ただけでは、5番の量子ビットを反転させればよい（他の量子ビットは反転させない）ことを知るには不十分であることがわかります。ただし、いくつかの量子ビットを何度も反転させてもよいという場合はこの限りではありませんが、それは理想的ではありません。</p>
<p>そこで、この場合、スタビライザーの測定結果に関数を適用し、その結果を動的回路の条件として使用できれば理想的です。</p>
<p>これは可能ですが、QiskitではなくOpen QASM3のコードで行う必要があり、このExerciseでは取り上げません。
Open QASM3によるDynamic Circuitについてもっと知りたい場合は、ここで情報を得ることができます：</p>
<p>https://quantum-computing.ibm.com/services/resources/docs/resources/manage/systems/dynamic-circuits/Dynamic-Circuits-basics-with-OpenQASM3</p>
<p>以下は、Open QASM3のコードの簡単な例です：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">qasm3</span><span class="p">,</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">transpile</span>

<span class="c1"># ベル回路を作成します</span>
<span class="n">qc_bell</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">qc_bell</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc_bell</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc_bell</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">qc_bell</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># デバイス用にトランスパイルします (上で述べたように、H ゲートと CX ゲートはありません)</span>
<span class="n">qc_bell</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc_bell</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

<span class="c1"># print前にqasm3コードを生成します</span>
<span class="n">exporter</span> <span class="o">=</span> <span class="n">qasm3</span><span class="o">.</span><span class="n">Exporter</span><span class="p">(</span>
    <span class="n">includes</span><span class="o">=</span><span class="p">[],</span> <span class="n">disable_constants</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">basis_gates</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">basis_gates</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qasm3_bell</span> <span class="o">:=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">qc_bell</span><span class="p">))</span>

<span class="c1"># 比較のために回路を描いてみます</span>
<span class="n">qc_bell</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">idle_wires</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OPENQASM 3;
bit[2] c;
rz(-3.141592653589793) $0;
sx $0;
rz(-1.570796326794897) $1;
sx $1;
rz(-3.141592653589793) $1;
ecr $1, $0;
rz(-1.5707963267948966) $0;
sx $0;
rz(1.5707963267948966) $0;
rz(1.5707963267948966) $1;
sx $1;
rz(1.5707963267948966) $1;
c[0] = measure $0;
c[1] = measure $0;
</pre></div>
</div>
<img alt="_images/fe2bf527211dbe60079e3e6612c308ae6c2fac531b5343561d15e3e675dc7b31.png" src="_images/fe2bf527211dbe60079e3e6612c308ae6c2fac531b5343561d15e3e675dc7b31.png" />
</div>
</div>
</section>
<section id="id6">
<h3>Step 3: エラーを増やさないためにはどうするか？<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<p>エラーが発生する原因はさまざまです。時間経過によるデコヒーレンスや、CX-Gateのようなエンタングルゲートで発生するエラーは、そのうちの2つです。この2つはスタビライザーにも当てはまるので、本末転倒にならないように、エラーを修正しようとすることでノイズを増やさないようにする必要があります。将来的には、一般的なエラーレートがさらに下がるので、それほど問題にはならないかもしれませんが、それでも考慮しなければならないことです。</p>
<p>このことは、私たちにとってどのような意味を持つのでしょうか？</p>
<p>スタビライザーを作成し、測定したい時について考えてみましょう。次の量子ビットのエンタングルに使われなくなった後、直接エンタングルを解くのでしょうか？ 回路全体がエンタングルされるまで待つのでしょうか？(これはもちろん、どのような種類のエラーを修正したいかによります。）また、スタビライザーをリセットして、後で新しいものを作る（同じ量子ビットを使う）、エラーを修正するために2つのフェーズを使う、ということも考えられます。</p>
<p>そして、（スタビライザーを通して）量子ビットをエンタングルすることでエラーが発生する確率はどれくらいなのかを考え、スタビライザーをアンエンタングルすることでエラーが発生する確率と比較することができます。つまり、スタビライザーがあることで、かえって悪化しているのかも？</p>
<p>その価値はいつあるのでしょうか？以下のコードで遊んでみて、印象やアイデアを得ることができます。ただし、これは将来、エラーレートがさらに低下したときに変更される可能性があります。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ここでのエラー確率はすべて、CXゲートによるエラーのみを考慮していて、またそれがビット・フリップ・エラーであると想定しています。</span>

<span class="c1"># 1つのCXゲートによるエラー確率</span>
<span class="n">p1</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># （スタビライザーを通る）2つのCXゲートの後にエラーが発生する確率</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span>

<span class="c1"># 正しい場合でも、スタビライザーが何かが間違っていることを示す確率</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CXゲート1つがエラーを持つ確率: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CXゲート2つの時にエラーが起こる確率: </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;スタビライザーが間違える確率: </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CXゲート1つがエラーを持つ確率: 0.01
CXゲート2つの時にエラーが起こる確率: 0.0198
スタビライザーが間違える確率: 0.0099
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-4">
<h3>Step 4: 何ができるでしょうか？<a class="headerlink" href="#step-4" title="Permalink to this heading">#</a></h3>
<p>あなたが試せる可能性はたくさんあります：</p>
<ul class="simple">
<li><p>複数のスタビライザーを使って何か良い論理的な機能を見つけ、QASM3を使ってみるのも良いでしょう。</p></li>
<li><p>スタビライザーをリセットして再利用することを考えることができます。</p></li>
<li><p>例Aのようなシンプルな方法をうまく使えないか試すことができます（測定するタイミングを変えるなど）。</p></li>
<li><p>自分自身のアイデアを見つけることができます！クリエイティブになりましょう！</p></li>
</ul>
<p>いずれも重要なのは、やみくもに量子コンピュータで試すのではなく、最初のGHZ状態を走らせたデータを使って、まず自分の考えを検証してみることです。</p>
<p>上記でテストデータを作成しました： GHZ状態の出力と、スタビライザーの出力があります。</p>
<p>あなたのアプローチが後処理としてうまくいかないのであれば、実機で動作させれば、すべての演算にさらなるエラーレートが発生するため、うまくいかないでしょう。</p>
<p>手持ちのデータで理論的に動作するアルゴリズムができたら（テストによりGHZ状態が良くなったら）、以下のコードを使って、エラー訂正を含む回路全体を実機で動かしてみることができるようになります。</p>
<p>*ヒント：上記のerror_correction関数を使用し、上記のerror_corrected_ghzも生成することを確認してください。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初めにGHZ状態を実際にデバイスにTranspileします</span>
<span class="n">qc_corrected_transpiled</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span>
    <span class="n">error_corrected_ghz</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">initial_layout</span><span class="o">=</span><span class="n">initial_layout</span>
<span class="p">)</span>

<span class="c1"># jobを実行します</span>
<span class="n">job_corrected</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">qc_corrected_transpiled</span><span class="p">,</span>
    <span class="n">dynamic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">shots</span><span class="o">=</span><span class="n">number_of_shots</span><span class="p">,</span>
    <span class="n">memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">job_tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="s2">&quot;spring_challenge&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">job_id</span> <span class="o">=</span> <span class="n">job_corrected</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job_corrected</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">retrieve_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
<span class="n">job_corrected</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 結果を呼び戻します</span>
<span class="n">counts_corrected</span> <span class="o">=</span> <span class="n">job_corrected</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="2023-spring-lab4-error-correction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">エラー訂正（2023年春 Lab4）</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-ghz">Step 1: 大きなGHZ状態を作る</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise 1 - 解答例</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2">Step 2: サイズを半分にする</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise 2 - 解答例</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3">Step 3: 準備し、実デバイスで実行する</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-ghz">Step 4: GHZ状態のテスト</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3">Exercise 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise 3 - 解答例</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">ボーナス: エラー訂正への道</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">Step 1: 実際の状態はどの程度よかったのか？</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Step 2: なぜ単一のスタビライザーだけでは不十分なのか</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Step 3: エラーを増やさないためにはどうするか？</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4">Step 4: 何ができるでしょうか？</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Quantum Tokyo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>